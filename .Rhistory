t = qnorm(1-k)
t1 = qnorm(1-lambdas*k)
z = dnorm(t)
i = z/k
res = 2*(t-t1*sqrt( 1-(t^2-t1^2)*(1-t/i)) )/(i+t1^2*(i-t))
res
lambdas= 3.2
k
t = qnorm(1-k)
t1 = qnorm(1-lambdas*k)
z = dnorm(t)
i = z/k
res = 2*(t-t1*sqrt( 1-(t^2-t1^2)*(1-t/i)) )/(i+t1^2*(i-t))
res
lambdas=9
k=.004
t = qnorm(1-k)
t1 = qnorm(1-lambdas*k)
z = dnorm(t)
i = z/k
res = 2*(t-t1*sqrt( 1-(t^2-t1^2)*(1-t/i)) )/(i+t1^2*(i-t))
res
k = .01
t = qnorm(1-k)
t1 = qnorm(1-lambdas*k)
z = dnorm(t)
i = z/k
res = 2*(t-t1*sqrt( 1-(t^2-t1^2)*(1-t/i)) )/(i+t1^2*(i-t))
res
source('~/Dropbox/2016_06_Gene/code1/2017-05-functions/function_heritability_liability.R')
func_hl(21329.17889, .01)
func_hl(21329.17889, .01)
func_hl(2.279660271, .01)
source('~/Dropbox/2016_06_Gene/code1/2017-05-functions/function_heritability_liability.R')
func_hl(2.279660271, .4)
source('~/Dropbox/2016_06_Gene/code1/2017-05-functions/function_heritability_liability.R')
func_hl(3.5, .03)
source('~/Dropbox/2016_06_Gene/code1/2017-05-functions/function_heritability_liability.R')
f(1.261964471, .02)
f(3.027388818, .5/100)
f(1.260169633, 6/100)
f(4.059416992, .5/100)
f(1.42523571, 15/100)
f(1.645579108, .5/100)
3.126237283
f(3.126237283, 1/100)
f(1.466039286, .08)
f( 0.2407192, .2/100)
f(2.193075594, .2/1--)
f(2.193075594, .2/100)
f(2.423369514, .01)
f(1.260169633, .06)
load("~/Dropbox/2016_06_Gene/Data_SummaryLevelConsortium/output_RData_v3/DIAGRAM_t2d_new2/3com_hm01.RData")
est
causalnum
herit
heritability
330/13
330/13
260/13
260/13
1055 + 75
rent = 1137.46
total = 3223.97
discover = 162.82
amx = 141.36
jipiao = 580
luluxing = sum(c(58, 160, 160, 258))
hotwire = 348.42
citi = 126.31
chase = c(406.61, 419.79)
sum(c(chase, citi, discover,amx))
sum(c(chase, citi, discover,amx,rent))
total
sum(c(jipiao,luluxing, hotwire))
dinner = c(26.94, 34.7, 5.46, 11.04, 14.66, 1.83, 4.21, 24.79, 11.93, 59, 48, 120, 40, 2.17, 9.75, 21.5, 11.58, 3.75, 5.23, 14.32, 15.99, 2.64, 20, 26.22)
sum(dinner)
sum(c(dinner, jipiao, luluxing, hotwire))
sum(rent, discover, citi, chase)
total
sum(rent, discover, citi, chase, 352.77)
sum(rent, discover, citi, chase, 352.77, amx)
total
chase
1055 + 75
1055 + 75 + 6.46
1065 + 75 + 6.46
1055 + 75 + 6.46
5400/30
5400/3
65000 - 4800
65000*2/3
65000*2/3 - 60200
17000* 7
setwd("~/Dropbox/2016_06_Gene/EffectSizeGWAS")
library(EffectSizeDist)
?esd2com
esd2com()
esd2com
library(devtools)
install("../EffectSizeGWAS/")
esd2com
install("../EffectSizeGWAS/")
esd2com
install("../EffectSizeGWAS/")
0.3/22
M
M = 10700
1070777
# ------------------------------------------------
# load the LD information f
library(data.table)
M
M = 1070777
M
pic = 1e-2
p1 = 1e-3; p2 = 0.1
sig1 = 1e-3; sig2 =1e-4; sig3 = (0.3/(pic*M) - (p1*sig1) - p2*sig2 )/ (1-p1-p2)
a = 2e-6
par_true = c(pic,p1,p2, sig1, sig2,sig3,a)
par_true
pic = 1e-2
p1 = 1e-2; p2 = 0.1
sig1 = 1e-3; sig2 =1e-4; sig3 = (0.3/(pic*M) - (p1*sig1) - p2*sig2 )/ (1-p1-p2)
a = 2e-6
par_true = c(pic,p1,p2, sig1, sig2,sig3,a)
par_true
pic = 1e-2
p1 = 5e-2; p2 = 0.1
sig1 = 1e-3; sig2 =1e-4; sig3 = (0.3/(pic*M) - (p1*sig1) - p2*sig2 )/ (1-p1-p2)
a = 2e-6
par_true = c(pic,p1,p2, sig1, sig2,sig3,a)
par_true
pic = 1e-2
p1 = 1e-2; p2 = 0.1
sig1 = 1e-3; sig2 =1e-4; sig3 = (0.3/(pic*M) - (p1*sig1) - p2*sig2 )/ (1-p1-p2)
a = 2e-6
par_true = c(pic,p1,p2, sig1, sig2,sig3,a)
par_true
pic = 1e-2
p1 = 1e-2; p2 = 0.1
sig1 = 1e-3; sig2 =1e-4; sig3 = (0.3/(pic*M) - (p1*sig1) - p2*sig2 )/ (1-p1-p2)
a = 2e-6
par_true = c(pic,p1,p2, sig1, sig2,sig3,a)
par_true
pic = 1e-2
p1 = 0.1; p2 = 0.2
sig1 = 1e-3; sig2 =1e-4; sig3 = (0.3/(pic*M) - (p1*sig1) - p2*sig2 )/ (1-p1-p2)
a = 2e-6
par_true = c(pic,p1,p2, sig1, sig2,sig3,a)
par_true
pic = 1e-2
p1 = 1e-2; p2 = 0.1
sig1 = 1e-3; sig2 =1e-4; sig3 = (0.3/(pic*M) - (p1*sig1) - p2*sig2 )/ (1-p1-p2)
a = 2e-6
par_true = c(pic,p1,p2, sig1, sig2,sig3,a)
M = 107700
pic = 1e-2
p1 = 1e-2; p2 = 0.1
sig1 = 1e-3; sig2 =1e-4; sig3 = (0.3/(pic*M) - (p1*sig1) - p2*sig2 )/ (1-p1-p2)
a = 2e-6
par_true = c(pic,p1,p2, sig1, sig2,sig3,a)
par_true
M = 1077000
pic = 1e-2
p1 = 1e-2; p2 = 0.1
sig1 = 1e-3; sig2 =1e-4; sig3 = (0.3/(pic*M) - (p1*sig1) - p2*sig2 )/ (1-p1-p2)
a = 2e-6
par_true = c(pic,p1,p2, sig1, sig2,sig3,a)
par_true
tolerance_pic=1e-6;
tolerance_p1=1e-5;
tolerance_sigsq1=1e-8;
tolerance_sigsq2=1e-8;
tolerance_a=1e-8;
tolerance_llk=1e-5;
maxEM=5e3;
steps=2;
functions_simu(betahat, varbetahat,ldscore,Nstar,TaggingSNPinx,n, M, modelcomponents=3, cores=10, LDcutoff=1, c0=5, print=TRUE,printfreq=10, P=5,gamma=0.5,starting=NA, tolerance=NA,
qqplot=F, qqplotCI=0.8, qqplotname="",summaryGWASLDdatasave=FALSE,qqplotdatasave=FALSE,siblingrisk=FALSE)
pic = 0.01
sigmasq = (3- 0.3*LLD)/sum((3-0.3*LLD)*pic)*0.3
a = 2e-6
par_true = c(pic,mean(sigmasq),a)
17/(17+37)
17/(17+37)
10/26
22/(22+65)
?cdf
?cnorm
?cdnorm
?dnorm
?pnorm
pnorm(1-0.044)
pnorm(0.044)
qnorm(1-0.044)
qnorm(0.044)
dnorm(qnorm(1-0.044))
dnorm(qnorm(0.044))
K  = 0.044
qnorm(1-K)
qnorm(K)
dnorm(qnorm(K))
dnorm(qnorm(1-K))
pnorm(-0.0154877/ 0.0224764)*2
pnorm(	-0.00365704/	0.045935)*2
pnorm(	-0.00349109/	0.0329093)*2
setwd("~/")
?merge
6828-6221
607+3400
9655 + 7333 + 4480
45954 + 42468 + 12632
paste(paste0(plinkpath,"/plink"),
"--gen", paste0(genfile,chr,".gen"),
"--sample", paste0(genfile,chr,".sample"),
"--make-bed --out", paste0("extract_",chr),
"--noweb"
)
plinkpath = "/dcl01/chatterj/data/yzhang/software/plink-1.07-x86_64"
gctapath = "/dcl01/chatterj/data/yzhang/software/gcta_1.26.0"
genfile = "/dcl01/chatterj/data/yzhang/2017_10_ukbiobank/code/extract/extract_gene/extract_"
paste(paste0(plinkpath,"/plink"),
"--gen", paste0(genfile,chr,".gen"),
"--sample", paste0(genfile,chr,".sample"),
"--make-bed --out", paste0("extract_",chr),
"--noweb"
)
system(code)
chr=1
code = paste(paste0(plinkpath,"/plink"),
"--gen", paste0(genfile,chr,".gen"),
"--sample", paste0(genfile,chr,".sample"),
"--make-bed --out", paste0("extract_",chr),
"--noweb"
)
code
14.5+12.5
27+2.5
?pnorm
qnorm
qnorm(1e-1)
qnorm(5e-8)
qnorm(1)
qnorm(.5)
qnorm(.4)
Rcpp::sourceCpp('Dropbox/2018_02_LDpred/code/c_marginalBayes/descent07202018.cpp')
load("/Users/dorazhang/Dropbox/2018_02_LDpred/code/c_marginalBayes/TaggingSNPinx.RData")
mapply_normalize(pairwise_r, )
Anorm = lapply_norm(pairwise_r);
Anorm = lapply_norm(pairwise_r, Anorm);
Asx = mapply_Ax(TaggingSNPinx, pairwise_rs, x);
pairwise_rs = mapply_normalize(pairwise_r, Anorm);
pairwise_rs[1]
Asx = mapply_Ax(TaggingSNPinx, pairwise_rs, x);
x = rnorm(length(pairwise_r))
Asx = mapply_Ax(TaggingSNPinx, pairwise_rs, x);
K = length(TaggingSNPinx)
x= rnorm(K)
Asx = mapply_Ax(TaggingSNPinx, pairwise_rs, x);
length(TaggingSNPinx)
length(x)
length(pairwise_r)
length(pairwise_rs)
pairwise_rs[1]
pairwise_r[1]
TaggingSNPinx[1]
summary(unlist(TaggingSNPinx))
Asx = mapply_Ax(TaggingSNPinx, pairwise_r, x);
length(x)
x[1]
x[length(x)]
te  = mapply_Ax(TaggingSNPinx, pairwise_r, x)
Rcpp::sourceCpp('Dropbox/2018_02_LDpred/code/c_marginalBayes/descent07202018.cpp')
te  = mapply_Ax(TaggingSNPinx, pairwise_r, x)
TaggingSNPinx[1]
load("~/Dropbox/2018_02_LDpred/code/marginalBayes//TaggingSNPinx.RData")
M = length(TaggingSNPinx)
K = M
# ------------------------------------------------# ------------------------------------------------
# Simulation: generate data.
# ------------------------------------------------# ------------------------------------------------
pic = 5e-3
sigmasq = 0.3/(M*pic)
a = 2e-6
par_true = c(pic,sigmasq,a)
# ------------------------------------------------
# generate causalnum causal SNPs, and hence then the true SNP effect size.
# generate 5000 causal SNPs, and hence then the true SNP effect size.
# generate the betajoint.
set.seed(123)
z = rbinom(K, size=1, prob=pic); nonzero = sum(z)
betajoint = rep(0, K)
betajoint[which(z==1)] = rnorm(nonzero,mean=0,sd=sqrt(sigmasq))
# ------------------------------------------------
betamarginal = rep(0,K);
for(k in 1:K){
betamarginal[k] = crossprod(betajoint[unlist(TaggingSNPinx[k])], (unlist(pairwise_r[k])))
}
xtrue = betajoint
b = betamarginal
te = descent(xtrue,b,TaggingSNPinx,pairwise_r,1e-3,100)
x = xtrue
te = mapply  Asx = mapply(function(inx,value){sum(value*x[inx])}, TaggingSNPinx, pairwise_rs)
Asx = mapply(function(inx,value){sum(value*x[inx])}, TaggingSNPinx, pairwise_r)
length(Asx)
Asx[1]
Asx[2]
Asx[1:10]
Ac = maply_Ax(TaggingSNPinx, pairwise_r, x)
Ac = mapply_Ax(TaggingSNPinx, pairwise_r, x)
Rcpp::sourceCpp('Dropbox/2018_02_LDpred/code/c_marginalBayes/descent07202018.cpp')
Ac = mapply_Ax(TaggingSNPinx, pairwise_r, x)
i=1
inxtem = TaggingSNPinx[i];
inxtem
pairwise_ri = pairwise_r[i];
pairwise_ri
x_inxtem = x[inxtem];
x
length(x)
mode(x)
inxtem
x_inxtem = x[inxtem[[1]]];
x_inxtem
Asx[1:10]
i=6
inxtem = TaggingSNPinx[i];
pairwise_ri = pairwise_r[i];
x_inxtem = x[inxtem[[1]]];
sumprod(pairwise_ri, x_inxtem)
pairwise_ri
sumprod(pairwise_ri[[1]], x_inxtem)
Rcpp::sourceCpp('Dropbox/2018_02_LDpred/code/c_marginalBayes/descent07202018.cpp')
Ac = mapply_Ax(TaggingSNPinx, pairwise_r, x)
Rcpp::sourceCpp('Dropbox/2018_02_LDpred/code/c_marginalBayes/descent07202018.cpp')
tt(x, c(1,2,3))
Ac = mapply_Ax(TaggingSNPinx, pairwise_r, x)
plot0 = function(x,y){plot(x,y)}
plot(1:3, 2:4)
plot(x=1:3, y=2:4)
plot0(1:3, 2:4)
pdf("a.pdf");plot0(1:3,2:4); dev.off()
getwd()
seq(1,102)
seq(1,10,2)
seq(1,10,1)
Rcpp::sourceCpp('Dropbox/2018_02_LDpred/code/c_marginalBayes/codescent092018.cpp')
Rcpp::sourceCpp('Dropbox/2018_02_LDpred/code/c_marginalBayes/codescent092018.cpp')
Rcpp::sourceCpp('Dropbox/2018_02_LDpred/code/c_marginalBayes/codescent092018.cpp')
Rcpp::sourceCpp('Dropbox/2018_02_LDpred/code/c_marginalBayes/codescent092018.cpp')
install.packages("RcppArmadillo")
install.packages("RcppArmadillo")
Rcpp::sourceCpp('Dropbox/2018_02_LDpred/code/c_marginalBayes/codescent092018.cpp')
Rcpp::sourceCpp('Dropbox/2018_02_LDpred/code/c_marginalBayes/codescent092018.cpp')
Rcpp::sourceCpp('Dropbox/2018_02_LDpred/code/c_marginalBayes/codescent092018.cpp')
shuffle(1:3)
Rcpp::sourceCpp('Dropbox/2018_02_LDpred/code/c_marginalBayes/codescent092018.cpp')
test(1:3)
Rcpp::sourceCpp('Dropbox/2018_02_LDpred/code/c_marginalBayes/codescent092018.cpp')
test(13)
test(1:3)
test(1:3)
test(1:3)
test(1:3)
test(1:3)
# ------------------------------------------------
#   Update on 11/26/2018
#   Created on 11/26/2018
#
#   Author: Yan (Dora) Zhang
#   Email: yandorazhang@gmail.com
# ------------------------------------------------
#1. generate the template
# nothing in the folder.
setwd("~/Dropbox/2016_06_Gene_revision/code_final_realdata/")
library(devtools)
library(Rcpp)
library(RcppArmadillo)
library(roxygen2)
# 2. put the EM_EM.cpp under /src directory; delete files under /R directory.
# generate RcppExports.cpp
setwd("GENESIS_Asian/")
compileAttributes(verbose=TRUE)
# ------------------------------------------------
#   Update on 11/26/2018
#   Created on 11/26/2018
#
#   Author: Yan (Dora) Zhang
#   Email: yandorazhang@gmail.com
# ------------------------------------------------
#1. generate the template
# nothing in the folder.
setwd("~/Dropbox/2016_06_Gene_revision/code_final_realdata/")
library(devtools)
library(Rcpp)
library(RcppArmadillo)
library(roxygen2)
# 2. put the EM_EM.cpp under /src directory; delete files under /R directory.
# generate RcppExports.cpp
setwd("GENESIS_Asian/")
compileAttributes(verbose=TRUE)
# ------------------------------------------------
#   Update on 11/26/2018
#   Created on 11/26/2018
#
#   Author: Yan (Dora) Zhang
#   Email: yandorazhang@gmail.com
# ------------------------------------------------
#1. generate the template
# nothing in the folder.
setwd("~/Dropbox/2016_06_Gene_revision/code_final_realdata/")
library(devtools)
library(Rcpp)
library(RcppArmadillo)
library(roxygen2)
RcppArmadillo.package.skeleton(name="GENESIS_Asian",example_code=F,
code_files=c("GENESIS/src/EM_EM.cpp"))
# ------------------------------------------------
#   Update on 11/26/2018
#   Created on 11/26/2018
#
#   Author: Yan (Dora) Zhang
#   Email: yandorazhang@gmail.com
# ------------------------------------------------
#1. generate the template
# nothing in the folder.
setwd("~/Dropbox/2016_06_Gene_revision/code_final_realdata/")
library(devtools)
library(Rcpp)
library(RcppArmadillo)
library(roxygen2)
RcppArmadillo.package.skeleton(name="GENESIS_Asian",example_code=F,
code_files=c("GENESIS/src/EM_EM.cpp"))
# ------------------------------------------------
#   Update on 11/26/2018
#   Created on 11/26/2018
#
#   Author: Yan (Dora) Zhang
#   Email: yandorazhang@gmail.com
# ------------------------------------------------
#1. generate the template
# nothing in the folder.
setwd("~/Dropbox/2016_06_Gene_revision/code_final_realdata/")
library(devtools)
library(Rcpp)
library(RcppArmadillo)
library(roxygen2)
RcppArmadillo.package.skeleton(name="GENESIS_Asian",example_code=F,
code_files=c("GENESIS/src/EM_EM.cpp"))
# ------------------------------------------------
#   Update on 11/26/2018
#   Created on 11/26/2018
#
#   Author: Yan (Dora) Zhang
#   Email: yandorazhang@gmail.com
# ------------------------------------------------
#1. generate the template
# nothing in the folder.
setwd("~/Dropbox/2016_06_Gene_revision/code_final_realdata/")
library(devtools)
library(Rcpp)
library(RcppArmadillo)
library(roxygen2)
RcppArmadillo.package.skeleton(name="GENESIS_Asian",example_code=F,
code_files=c("GENESIS/src/EM_EM.cpp"))
# 2. put the EM_EM.cpp under /src directory; delete files under /R directory.
# generate RcppExports.cpp
setwd("GENESIS_Asian/")
compileAttributes(verbose=TRUE)
using namespace Rcpp;
# ------------------------------------------------
#   Update on 11/26/2018
#   Created on 11/26/2018
#
#   Author: Yan (Dora) Zhang
#   Email: yandorazhang@gmail.com
# ------------------------------------------------
#1. generate the template
# nothing in the folder.
setwd("~/Dropbox/2016_06_Gene_revision/code_final_realdata/")
library(devtools)
library(Rcpp)
library(RcppArmadillo)
library(roxygen2)
RcppArmadillo.package.skeleton(name="GENESIS_Asian1",example_code=F,
code_files=c("GENESIS/src/EM_EM.cpp"))
# ------------------------------------------------
#   Update on 11/26/2018
#   Created on 11/26/2018
#
#   Author: Yan (Dora) Zhang
#   Email: yandorazhang@gmail.com
# ------------------------------------------------
#1. generate the template
# nothing in the folder.
setwd("~/Dropbox/2016_06_Gene_revision/code_final_realdata/")
library(devtools)
library(Rcpp)
library(RcppArmadillo)
library(roxygen2)
RcppArmadillo.package.skeleton(name="GENESISasian",example_code=F,
code_files=c("GENESIS/src/EM_EM.cpp"))
# 2. put the EM_EM.cpp under /src directory; delete files under /R directory.
# generate RcppExports.cpp
setwd("GENESISasian/")
compileAttributes(verbose=TRUE)
# 2. put the EM_EM.cpp under /src directory; delete files under /R directory.
# generate RcppExports.cpp
setwd("GENESISasian/")
compileAttributes(verbose=TRUE)
grep -rl '1070777' ./ | xargs sed -i '' -e 's/1070777/953834/g'
